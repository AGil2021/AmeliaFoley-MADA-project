---
title: "exploration"
output: html_document
---

For this project, I began with microplastic count data for various sample sites, variables including site, watershed, latitude, longitude, and a_count and b_count. So far, I have obtained the following additional data: 

 - local land cover based on coordinates converted to census FIPS codes, using NGIS data
 - bacterial data from corresponding UOWN sample dates/sites
 - location population levels by zip code, converted from lat/long and joined with census data. 
 
In this document, I will explore relationships between some of these variables. 

Quantities of main interest: 
 - particles per liter of microplastics
 - season/sample date
 - population level
 - proximity to water reclamation facility effluent
 - bacteria levels at corresponding samples sites/dates
 
# load packages and data
```{r}
library(dplyr) #for data processing
library(here) #to set paths
library(tidyverse)
library(ggplot2)
library(geodist) #to calculate distance from sample site to each water reclamation facility
library(GGally) #for producing correlation matrices

#path to data
data_location <- here::here("data","processed_data","mpwrfcombo.rds")

#load data
mpdata <- readRDS(data_location)

```

# MP concentration by season
```{r}
summary(mpdata)

# view particles/L by season

mpdata$date <- factor(mpdata$date , levels=c("nov_20", "feb_21", "apr_21", "july_21"))

p1 <- mpdata %>% ggplot(aes(x = date, y = particles_l)) + 
  geom_boxplot(aes()) + 
  labs(title = "Microplastic Concentration by Sample Date", x = "Date", y = "Particles/Liter") + 
  scale_x_discrete(labels=c("Fall 2020",
                            "Winter 2021",
                            "Spring 2021",
                            "Summer 2021"))

plot(p1)

#save figure
ggsave(filename = here("results","concentrationbydate.png"), plot=p1)
```
 
Here, we can see that the levels of microplastics are similar, from a wide lens, through the four sample dates. There are a few outliers - it would be interesting to look at the data when excluding outliers. I'll have to look into what the best practice for that is. Also, for final products, I'll want to reorder the dates so that Nov 2020 is listed first (chronologically), and I will relabel everything to make it neater as well. 
 
 
 For all samples, let's compare microplastic level and local population. 
 
# MP level vs population
```{r}
p2 <- mpdata %>% ggplot(aes(x = population, y = particles_l)) + geom_point() +
  labs(title = "Microplastic Concentration vs Population", x = "Population", y = "Particles/Liter")

plot(p2)

#save figure
ggsave(filename = here("results","particlesvpop.png"), plot=p2)
```

I'm not seeing any obvious relationships here. Also, population values are appearing discrete rather than continous since there are a limited number of zip codes in the study area, and population was based on zip code. 

# particles vs population with log transformation
```{r}
p3 <- mpdata %>% ggplot(aes(x = population, y = particles_l)) + 
  geom_point() + 
  scale_y_continuous(trans='log10') +
  labs(title = "Microplastic Concentration vs. Population", x = "Population", y = "Log(Particles/Liter)")

plot(p3)
#save figure
figure_file = here("results","logparticlesvpop.png")
ggsave(filename = figure_file, plot=p3)
```


# plot e.coli.cfu vs particles_l
```{r}
p4 <- mpdata %>% ggplot(aes(x = e.coli.cfu, y = particles_l)) + 
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, hjust=1)) +
  labs(title = "Microplastic Concentration vs. E. coli CFU", x = "CFU", y = "Particles/Liter")

plot(p4)

#save figure
figure_file = here("results","mpvcfu.png")
ggsave(filename = figure_file, plot=p4)
```

Again, no obvious relationships here. How about if we looked with a logarithmic scale? 

```{r}
p5 <- mpdata %>% ggplot(aes(x = e.coli.cfu, y = particles_l)) + 
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, hjust=1)) + 
  scale_x_continuous(trans='log10') +
  scale_y_continuous(trans='log10') + 
  labs(title = "Microplastic Concentration vs. E. coli CFU", x = "Log(CFU)", y = "Log(Particles/Liter)")

plot(p5)

#save figure
figure_file = here("results","logmpvcfu.png")
ggsave(filename = figure_file, plot=p5)
```


Let's look at overall distribution of MP levels.

# Distribution of MP concentration
```{r}
mpdata %>% ggplot(aes(x = particles_l)) + geom_histogram() + 
  labs(title = "Distribution of Microplastic Concentration", x = "Particles/Liter", y = "Observations")
```


We have some large outliers that make it harder to view the exact distribution of the lower values. Let's filter out the outliers for a moment. 

# Distribution of MP concentration without outliers
```{r}
p6 <- mpdata %>% filter(particles_l < 400) %>% ggplot(aes(x = particles_l)) + geom_histogram() + 
  labs(title = "Distribution of Microplastic Concentration", x = "Particles/Liter", y = "Observations")

plot(p6)

#save figure
figure_file = here("results","distribution.png")
ggsave(filename = figure_file, plot=p6)
```

We see that most levels fall below 100 particles per liter. 
# Summary statistics
```{r}
summary(mpdata$particles_l)
```

These summary statistics give us a little more descriptive information about the dataset. The other variables that I wanted to look at particles per liter alongside were land cover. The process for looking at land cover will be a little more complicated - there a key for variable names corresponding to land types that I need to look closer at, and I am also not sure if the scale of the land cover data will be appropriate. Currently, it is at the census FIPS code level (approximately county level). Since most of these samples occur within that same area, we don't have other reference areas for comparison. I'll have to think about what I can do with this information. 

# correlation matrices
```{r}
#subsetting data to keep only variables we are interested in for the corr plot
mpdatacorr <- mpdata %>% select(-"quarter", 
                                -"month", 
                                -"lat",
                                -"long", 
                                -"year")

#correlation using MP, UOWN, population data
p7 <- ggcorr(mpdatacorr, 
       label_alpha = TRUE) + labs(title = "Microplastic Predictor Correlation Matrix")

plot(p7)
#save figure
figure_file = here("results","matrix.png")
ggsave(filename = figure_file, plot=p7)
```


# exploring land use with a correlation matrix
```{r}
athensland <- readRDS(here("data", "processed_data", "athensland.rds"))

#subset data to view in plot
athenslandcorr <- athensland %>% select(-"long", 
                                        -"lat") 

#land use correlation matrix
p8 <- ggcorr(athenslandcorr, 
       label_alpha = TRUE) + labs(title = "Land Use Correlation Matrix")

plot(p8)
#save figure
figure_file = here("results","landmatrix.png")
ggsave(filename = figure_file, plot=p8)
```

# concentration at each site throughout seasons
```{r}
p9 <- mpdata %>% ggplot(aes(x = site, y = particles_l, color = date)) + 
  geom_point() + scale_color_discrete(name = "Date", 
                                     breaks= c("nov_20", "feb_21", "apr_21", "july_21"), 
                                     labels = c("Fall 2020", "Winter 2021", "Spring 2021", "Summer 2021")) +
  theme(axis.text.x = element_text(angle = 90, hjust=1)) +
  labs(title = "Seasonal Microplastic Concentration by Site", x = "Site", y = "Particles/Liter") + ylim(0,500) #removing outliers to better visualize majority of concentrations

plot(p9)
#save figure
figure_file = here("results","seasonalconc_bysite.png")
ggsave(filename = figure_file, plot=p9)
```

# View concentration by watershed
```{r}
p10 <- mpdata %>% ggplot(aes(x = watershed, y = particles_l, color = )) + 
  geom_boxplot()  +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  labs(title = "Microplastic Concentration by Watershed", x = "Watershed", y = "Particles/Liter") + ylim(0,500)

plot(p10)
#save figure
figure_file = here("results","conc_bywatershed.png")
ggsave(filename = figure_file, plot=p10)
```
# Boxplot for individual sites throughout season
```{r}
p11 <- mpdata %>% ggplot(aes(x = site, y = particles_l, color = )) + 
  geom_boxplot()  +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  labs(title = "Microplastic Concentration by Site", x = "Site", y = "Particles/Liter") + ylim(0,500)

plot(p11)
#save figure
figure_file = here("results","conc_bysite.png")
ggsave(filename = figure_file, plot=p11)
```
# concentration over time by watershed
```{r}
# calculate mean concentration in each watershed for each sample date
mean_data <- group_by(mpdata, watershed, date) %>%
             summarise(particles_l = mean(particles_l, na.rm = TRUE))

# create plot using mean data
p12 <- mean_data %>% ggplot(aes(x = date, y = particles_l, color = watershed, group = watershed)) + 
  geom_point() + geom_path() + scale_color_discrete(name = "Watershed")+ 
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  labs(title = "Watershed Microplastic Concentration Over Time", x = "Watershed", y = "Particles/Liter") + scale_x_discrete(labels=c("Fall 2020",
                            "Winter 2021",
                            "Spring 2021",
                            "Summer 2021"))+ 
  ylim(0,300) #removing outliers to better visualize majority of concentrations

plot(p12)
#save figure
figure_file = here("results","watershed_overtime.png")
ggsave(filename = figure_file, plot=p12)
```

Nice! Going forward, I should think about whether to keep or remove the watersheds that were only sampled in the last (July) sampling. I also see that some watershed are missing intermediate data points and are not connected. Would we want to connect and skip over a season, or leave them unconnected (looking at Oconee River)